{% extends '@WebProfiler/Profiler/layout.html.twig' %}

{% block toolbar %}

    {% set icon %}
        {# this is the content displayed as a panel in the toolbar #}
        {{ include('@ElaoAccesseo/profiler/204-link.svg.twig') }}
        <span class="sf-toolbar-value">SEO</span>

    {% endset %}

    {% set text %}
        {# this is the content displayed when hovering the mouse over
           the toolbar panel #}
        <div class="sf-toolbar-info-piece">
            <b>Title</b>
            <span>{{ collector.truncatedTitle }}</span>
        </div>
        <div class="sf-toolbar-info-piece">
            <b>Meta Description</b>
            <span>{{ collector.truncatedMetaDescription }}</span>
        </div>
        <div class="sf-toolbar-info-piece">
            <b>First H1 found</b>
            {% if collector.atLeastOneH1 %}
                <span>{{ collector.truncatedH1 }}</span>
            {% else %}
                <span>No H1 found</span>
            {% endif %}
        </div>
        <div class="sf-toolbar-info-piece">
            <b>X-Robots-Tag</b>
            <span>{{ collector.XRobotsTag }}</span>
        </div>
        <div class="sf-toolbar-info-piece">
            <b>Robots <meta> tag</b>
            <span>{{ collector.metaRobot }}</span>
        </div>
        <div class="sf-toolbar-info-piece">
            <b>Canonical</b>
            {% if collector.canonical %}
                <span>{{ collector.canonical }}</span>
            {% else %}
                <span class="help">No canonical</span>
            {% endif %}
        </div>
    {% endset %}

    {# the 'link' value set to 'false' means that this panel doesn't
       show a section in the web profiler #}
    {{ include('@WebProfiler/Profiler/toolbar_item.html.twig', { link: true }) }}
{% endblock %}
{% block head %}
    {# Optional. Here you can link to or define your own CSS and JS contents. #}
    {# Use {{ parent() }} to extend the default styles instead of overriding them. #}
    {{ parent() }}
    <style>
        .text-warning { color: var(--color-warning); }
        .text-error { color: var(--color-error); }

        .tab-navigation li .badge.status-success { background: var(--color-success); color: #FFF; }

        .card.status-info { background-color: rgba(32, 139, 195, .2); }

        .code-inline { display: inline-block; }

        table ul li,
        table p { margin: 0; }
        table .small-cell { width: 45px; }

        .icon-danger {
            fill: var(--base-5);
            background: #fff !important;
            border-radius: 50px;
        }

        .icon-danger.status-error {
            fill: var(--color-error);
        }

        .sf-tabs .icon-danger {
            vertical-align: middle;
            border: solid 1px #fff;
        }

        .headings-tree {
            padding: 0 0 0 20px;
            list-style:  none;
        }

        .headings-tree:first-child {
            padding:  0;
        }
    </style>
{% endblock %}

{% block menu %}
    {# This left-hand menu appears when using the full-screen profiler. #}
    <span class="label">
        <span class="icon">
            {{ include('@ElaoAccesseo/profiler/204-link.svg.twig') }}
        </span>
        <strong>SEO</strong>
    </span>
{% endblock %}

{% block panel %}
    {# Optional, for showing the most details. #}
    <h2>SEO insights âœ¨</h2>

    {{ include('@ElaoAccesseo/profiler/headings_elements.html.twig') }}

    <h3>Robots directives</h3>
    {# Todo : if missing meta, show alert (mandatory meta) or warning (recommended meta)
        <div class="card status-warning">
            <strong>Warning : Missing hreflang on this page.</strong>
        </div>
        <div class="card status-error">
            <strong>Error : Missing XRobotsTag on this page.</strong>
        </div>
    #}
    <table>
        <tr>
            <th class="font-normal text-muted">Canonical URL (<a href="https://moz.com/learn/seo/canonicalization">more informations</a>)</th>
            {% if collector.canonical %}
                <td class="font-normal">
                    <a href="{{ collector.canonical }}">{{ collector.canonical }}</a>
                </td>
            {% else %}
                <td class="font-normal">
                    Missing
                </td>
            {% endif %}
        </tr>
        <tr>
            <th class="font-normal text-muted">Language (<a href="https://www.w3.org/International/articles/language-tags/">more informations</a>)</th>
            {% if collector.language %}
                <td class="font-normal">{{ collector.language }}</td>
            {% else %}
                <td class="font-normal">
                    Missing
                </td>
            {% endif %}
        </tr>
        <tr>
            <th class="font-normal text-muted">Hreflang (<a href="https://developers.google.com/search/docs/advanced/crawling/consolidate-duplicate-urls">more informations</a>)</th>
            {% if collector.isHrefLang %}
                <td class="font-normal">
                    {% for href in collector.hreflang %}
                        <div>
                            {{ href['hreflang'] }}
                            (<a href="{{ href['href'] }}">{{ href['href'] }}</a>)
                        </div>
                    {% endfor %}
                </td>
            {% else %}
                <td class="font-normal">Missing</td>
            {% endif %}
        </tr>
        <tr>
            <th class="font-normal text-muted">Robots meta directives (<a href="https://moz.com/learn/seo/robots-meta-directives">more informations</a>)</th>
            {% if collector.metaRobot %}
                <td class="font-normal">{{ collector.metaRobot }}</td>
            {% else %}
                <td class="font-normal">
                    Missing
                </td>
            {% endif %}
        </tr>
        <tr>
            <th class="font-normal text-muted">Googlebot meta directives (<a href="https://developers.google.com/search/docs/advanced/robots/robots_meta_tag">more informations</a>)</th>
            {% if collector.metaGooglebot %}
                <td class="font-normal">{{ collector.metaGooglebot }}</td>
            {% else %}
                <td class="font-normal">
                    Missing
                </td>
            {% endif %}
        </tr>
        <tr>
            <th class="font-normal text-muted">Googlebot-news meta directives (<a href="https://developers.google.com/search/docs/advanced/robots/robots_meta_tag">more informations</a>)</th>
            {% if collector.metaGooglebotNews %}
                <td class="font-normal">{{ collector.metaGooglebotNews }}</td>
            {% else %}
                <td class="font-normal">
                    Missing
                </td>
            {% endif %}
        </tr>
    </table>

    <h3>Qualify Outbound links</h3>

    <p class="text-muted">You might wanted to tell Search Engine robots how to interpret the relation with the linked page, using `rel` attribute values in the `< a >` tag. <a href="https://developers.google.com/search/docs/advanced/guidelines/qualify-outbound-links?hl=en">More informations on official documentation of Google.</a></p>
    <table>
        <thead>
        <tr>
            <th>href</th>
            <th>text</th>
            <th>rel attribute</th>
        </tr>
        </thead>
        <tbody>
        {% for link in collector.qualifiedOutboundLinks %}
        <tr>
            <td>{{ link.href }}</td>
            <td>{{ link.text }}</td>
            <td>{{ link.rel }}</td>
        </tr>
        {% endfor %}
        </tbody>
    </table>

    <h3>Social Media metas</h3>
    <div class="sf-tabs">
        <div class="tab">
            <span class="tab-title">
                {% if collector.missingOpenGraphProperties|length > 0 %}
                    {{ include('@ElaoAccesseo/profiler/danger.svg') }}
                {% endif %}
                Opengraph properties
            </span>
            <div class="tab-content">
                {% if collector.missingOpenGraphProperties|length > 0 %}
                 <div class="card status-warning">
                    <strong>Warning : missing {{ collector.missingOpenGraphProperties|join(',') }}  in Opengraph properties</strong>
                </div>
                {% endif %}

                <table>
                    <tr>
                        <th class="font-normal text-muted">Fulfilled properties</th>
                        <td>
                            {{ profiler_dump(collector.seek('OpenGraphProperties'), maxDepth=1) }}
                        </td>
                    </tr>
                    <tr>
                        <th class="font-normal text-muted">Missing properties</th>
                        <td>
                            {{ profiler_dump(collector.seek('missingOpenGraphProperties'), maxDepth=1) }}
                        </td>
                    </tr>
                </table>
            </div>
        </div>

        <div class="tab">
            <span class="tab-title">
                {% if collector.missingTwitterProperties|length > 0 %}
                    {{ include('@ElaoAccesseo/profiler/danger.svg') }}
                {% endif %}
                Twitter card properties
            </span>
            <div class="tab-content">

                {% if collector.missingTwitterProperties|length > 0 %}
                    <div class="card status-error">
                        <strong>Warning : missing {{ collector.missingTwitterProperties|join(',') }} in Twitter card properties</strong>
                    </div>
                {% endif %}

                <table>
                    <tr>
                        <th class="font-normal text-muted">Fulfilled properties</th>
                        <td class="font-normal">
                            {{ profiler_dump(collector.seek('twitterProperties'), maxDepth=1) }}
                        </td>
                    </tr>
                    <tr>
                        <th class="font-normal text-muted">Missing properties</th>
                        <td class="font-normal">
                            {{ profiler_dump(collector.seek('missingTwitterProperties'), maxDepth=1) }}
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
{% endblock %}
